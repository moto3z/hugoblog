---
title: "20240629 HTTP 트래픽 유실 이슈해결하기"
date: 2024-06-29T17:13:14+09:00
draft: false
---


## 1 개요
- 혹시 택배완료 알람을 받고 설레는 마음으로 집에 도착했는데, 물건이 온데간데 없었던 경험이 있으신가요? 저는 졸업작품을 만들때 사용할 전자부품을 국제특송으로 시켰는데 내용물이 사라져 "아 이번학기 졸업은 물건너간건가? ㅠㅠ" 라는 생각이 들만큼 아찔했던 상황이 있었습니다. 다행이 물건은 이름이 비슷한 다른 근처 아파트단지로 배송되어서 무사히 물건도 찾고 졸업도 재때 했던 기억이 있습니다. 이렇게 배달중 내용물이 사라져서 찾지 못하는 상황을 만나게 되면 참 난감한데요. 
- 특히 HTTP로 들어오는 트래픽이 유실되거나, 외부연동에서 트래픽이 유실되는 경우에는 서버측도 클라이언트 측도 난감한 상황이 발생합니다. 
```
우리는 분명히 줬는데 VS 우리는 받은게 없는데
```
- 이 글에서는 HTTP 유실 문제의 원인을 간단히 살펴보고, 이를 해결한 경험과 제가 처했던 상황을 공유하고자 합니다. 


## 2 문제 상황 정의
- 문제가 발생할 당시를 간단하게 설명하면 아래와 같습니다.
```text
+-----------------------+               +-----------------------+
|                       |               |                       |
| A회사 레거시 시스템   |  ------->     |   B 신규연동 시스템   |
|                       |   http        |                       |
+-----------------------+               +-----------------------+
```
- 저는 B 신규연동 시스템의 입장이였고, 평균적으로 1시간당 2만건정도씩 http traffic 을 처리하는데 한달에 30건/ 24시간마다 1번의 http 
- 참고로 이 글에서 http 리퀘스트는 모두 https 를 사용하는데 편의상 http 라고 표현하겠습니다.
- 

```text
+-----------+      +-----+      +---------+      +---------+      +------+      +------------+      +-----------+
|클라이언트 | ---> | DNS | ---> | 인터넷  | ---> | 방화벽  | ---> | LB   | ---> |ForwardProxy| ---> | 서버      |
+-----------+      +-----+      +---------+      +---------+      +------+      +------------+      +-----------+
```
- 전체 구간은 위의 그림처럼 클라이언트, DNS, 인터넷, 방화벽, LB, 공통 FF, 서버
- 통제 불가능 영역, 로그나 덤프를 받아볼수도 없는 영역인 인터넷 이전 영역을 포함하면 4개의 Layer가 남게 됩니다.



```text
+---------+      +------+      +------------+      +-----------+
| 방화벽  | ---> | LB   | ---> |ForwardProxy| ---> | 서버      |
+---------+      +------+      +------------+      +-----------+
```
- ForwardProxy : 여기서ㅏ
- [Apache Camel](https://camel.apache.org)
