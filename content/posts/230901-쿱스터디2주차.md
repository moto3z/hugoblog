---
title: "230901 쿱스터디2주차"
date: 2023-08-28T20:55:38+09:00
draft: false
---


## 12. Docker-vs-ContainerD

- 쿠버네티스
 - rkt(로켓)
 - 컨테이너디
 - 도커

### 컨테이너디 (이하 컨디)
- 컨테이너디 CIL : ctr
- 도커링 비슷한 crt이 nerdctl / 범생이ctr
- 예시
```
docker
= nerdctl

docker run --name redis redis:alpine
= nerdctl run --name redis redis:alpine

docker run --name webserver -p 80:80 -d nginx
= nerdctl run --name webserver -p 80:80 -d nginx
```

### crictl
- CLI for CRI 호환 컨테이너 런타임
- 검사하고 디버깅에 사용
- 컨디 커뮤니티를 위해 작성됨
- 디버깅툴임! 큐블렛이랑 잘어울림
- 예시
```
crictl pull busybox
crictl imges
crictl ps -a
crictl pods << pod 리스트 출력됨
```

### 요약
- ctr : 안씀
- nerdcrl : 쓸꺼임 dockerCLI 랑 비슷함
- crictl : 디버깅용으로만 쓰는데, 쿱커뮤니티에서 만든거임


<br><br><br><br>

## 13. ETCD For Beginners

- etcd 관련 배울점
  - 이게 뭔지
  - key-value 스토어
  - 가볍게 시작하기
  - 써먹는방법
  - 분산시스템
  - RAFT 프로토컬
  - 베스트 프렉티스

### ETCD
- key-value 스토어 형식임 : HashMap 이나 레디스같은거.. 
- JSON 이나 YAML 형식 씀
- etcd 컨트롤 클라이언트 설치해서 쓸수도 있음

### ETCD 버전정보
- v2 랑 v3 랑 차이가 많다
- 이 명령어로 버전 확인 `etcdctl --version`
- ectd 버전3 라도 api 버전2 로 동작도 가능하다

<br><br><br>

## 14. ETCD in Kubernetes

### etcd 가 쿱에서 어떻게? 어떤 부분에서 사용되나??
```
nodes
pods
configs
secrets
accounts
roles
bindings
other....
```
- 그냥 모든곳에 다쓰이는 근간이라고 할수 있다
- 쿠버네티스에 뭔가를 하는거가 그냥 etcd 서버에 뭔가를 변경하는거랑 같음
- etcd 설치하고 싶음 : 깃헙 coreos/etcd 가서 다운받기

```
$ kubectl get pods -n kube-system

NAME                                              READY   STATUS      RESTARTS   AGE
calico-kube-controllers-@@@@@@@@@@-kzm6v          1/1     Running     1          185d
calico-node-@@@@@                                 1/1     Running     1          185d
coredns-@@@@@@@@@@@@@@                            1/1     Running     3          424d
coredns-secondary--@@@@@@@@@@@@@@@                1/1     Running     2          424d
csi-cinder-controllerplugin-@                     6/6     Running     0          5d7h
csi-cinder-nodeplugin-@@@@@                       3/3     Running     0          5d7h
dns-autoscaler--@@@@@@@@@@@@@@                    1/1     Running     2          424d
dns-autoscaler-secondary-@@@@@@@@@@@@@@@          1/1     Running     2          424d
kube-apiserver-@@@@@@@@@@@@@-master-1             1/1     Running     2          517d
kube-apiserver-@@@@@@@@@@@@@-master-2             1/1     Running     5          517d
kube-apiserver-@@@@@@@@@@@@@-master-3             1/1     Running     3          243d
kube-controller-manager-@@@@@@@@@@@@@-master-1    1/1     Running     22         183d
kube-controller-manager-@@@@@@@@@@@@@-master-2    1/1     Running     15         183d
kube-controller-manager-@@@@@@@@@@@@@-master-3    1/1     Running     16         183d
kube-proxy-@@@@@                                  1/1     Running     0          108d
kube-proxy-@@@@@                                  1/1     Running     0          144d
kube-scheduler-@@@@@@@@@@@@@-master-1             1/1     Running     15         183d
kube-scheduler-@@@@@@@@@@@@@-master-2             1/1     Running     17         183d
kube-scheduler-@@@@@@@@@@@@@-master-3             1/1     Running     21         183d
@@@@@@@-fluent-bit-@@@@@                          1/1     Running     0          179d
local-volume-provisioner-@@@@@                    1/1     Running     4          490d
metrics-server-@@@@@@@@@@-@@@@@                   2/2     Running     1          144d
```

- 만들다가 망한 장난감 1호기 뭐가 적혀있는지 찾아봤음

- HA 구성은 마스터노드 여러개여야함
  - 엣시디 서버도 마스터마다 각각 존재한다는건가?? 궁금함(@@@)


<br><br><br><br>


## 16. Kube-API Server
-  Kube-API Server 가 하는dlf

```
[kube-apiserver]
- 1) kubectl 명령어 입력받아서
- 2) 유효성 검증하고
- 3) ETCD 클러스터에다가 검색
- 4) ETCD 클러스터에다가 변경사항 업데이트

[master]

[worker code]

[kube-scheduler]
- 5) 스케쥴러가 돌면 kube-apiserver 가 일하게 만듬

[???]
- 6) Kublet : 뭔지모름

==============================
사용자 : kubectl 명령어 입력시
```


### 팁
- 큐브adm 같은걸로 돌리면 이런거 몰라도 되는데
- 하드웨이로 한땀한땀 구성했으면.. 알고있을꺼다
- 마스터 하나마다 api-server 하나씩 있음



